library(tidyverse)
library(phangorn)
library(DECIPHER)
setwd('..')
seqtab.nochim0 <- read.csv('data1/seqtab.nochimMar2018.csv')
seqtab.nochim <- seqtab.nochim0[,-1]
rownames(seqtab.nochim) <- seqtab.nochim0[,1]

seqs <- colnames(seqtab.nochim)
names(seqs) <- seqs

ptm <- proc.time()
alignment <- AlignSeqs(DNAStringSet(seqs), anchor = NA)
proc.time() - ptm


phang.align <- phyDat(as(alignment, "matrix"), type="DNA")
dm <- dist.ml(phang.align)
treeNJ <- NJ(dm) # Note, tip order != sequence order
fit = pml(treeNJ, data=phang.align)
fitGTR <- update(fit, k=4, inv=0.2)

ptm <- proc.time() # slow step
fitGTR <- optim.pml(fitGTR, model="GTR", optInv=TRUE, optGamma=TRUE,
                    rearrangement = "stochastic", control = pml.control(trace = 0))

ptm <- proc.time()
